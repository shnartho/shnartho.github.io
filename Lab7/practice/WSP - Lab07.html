<!DOCTYPE html>
<html>
    <body>

        <h3 id="title">GAME!</h3>

        <h4 id="points">POINTS: 0</h4>

        <script>
            const height = 20;
            const width = 20;
            const necesitaControl = "yellow";
            const colors = ["yellow", "pink", "green", "magenta", "orange"];
            const pointRemoveRectangle = 1;
            const pointWriteCorrectLetter = 1;
            const maxPoints = 10;
            
            var idFromLastSquareRemoved = null;
            var firstAttempt = false;
            
            var start = false;
            var points = 0;
        </script>

        <div id="greyDiv" style="border:1px solid grey; background-color: lightgray; width: 300px; height: 150px; position: relative; " onmouseover="startGame()"></div>
        <div id="padre">
            <input type="text" id="letter" name="letter" onkeyup="writeLetter()">
        </div>
        

        <script>
            function startGame() {
                if (! start  &&  confirm("Do you want to play?")) {
                    points = 0;
                    for (var i=0; i<colors.length ; i++) {
                        let previous = document.getElementById(colors[i]);
                        if (previous != null) {
                            previous.remove();
                        }
                    }
                    start = true;
                    drawRectangles();
                }
            };

            function overlap(x, y, otherPoints){
                for (var i=0 ; i<otherPoints.length ; i++) {
                    if ( (x>=otherPoints[i][0]  &&  x<=otherPoints[i][0]+width  &&  y>=otherPoints[i][1]  &&  y<=otherPoints[i][1]+height)) {
                        return true;
                    }
                    if ( x+width>=otherPoints[i][0]  &&  x+width<=otherPoints[i][0]+width  &&  y>=otherPoints[i][1]  &&  y<=otherPoints[i][1]+height) {
                        return true;
                    }
                    if ( x>=otherPoints[i][0]  &&  x<=otherPoints[i][0]+width  &&  y+height>=otherPoints[i][1]  &&  y+height<=otherPoints[i][1]+height) {
                        return true;
                    }
                    if ( x+width>=otherPoints[i][0]  &&  x+width<=otherPoints[i][0]+width  &&  y+height>=otherPoints[i][1]  &&  y+height<=otherPoints[i][1]+height) {
                        return true;
                    }
                }
                return false;
            }

            function drawRectangles() {
                firstVertices = [];
                
                for (var i=0 ; i<colors.length ; i++) {
                    let newDiv = document.createElement("div");
                    newDiv.setAttribute("id", colors[i]);
                    
                    var x = -1;
                    var y = -1;
                    do {
                        x = Math.floor(Math.random() * ((300-width) - 0) + 0);
                        y = Math.floor(Math.random() * ((150-height) - 0) + 0);
                    } while ( overlap(x, y, firstVertices) );
                    firstVertices.push( [x, y] );

                    newDiv.setAttribute(
                        "style",
                        "height: " + height + "px; " +
                        " width: " + width + "px; " + 
                        " border:1px solid red; " + 
                        " background-color: " + colors[i] + ";" +
                        " position: absolute; " + 
                        " left: " + x + "px; " +
                        " top: " + y + "px; "
                        );

                    (document.getElementById("greyDiv")).append(newDiv);
                        
                    newDiv.addEventListener("click", function() {removeRectangle(newDiv); } );
                    
                }
            }

            function removeRectangle(element)
            {
                if ((element.getAttribute("id") == necesitaControl && window.event.ctrlKey)  || (element.getAttribute("id") != necesitaControl &&  !window.event.ctrlKey) ) {
                    idFromLastSquareRemoved = element.getAttribute("id");
                    element.remove();
                    points += pointRemoveRectangle;
                    document.getElementById("points").innerHTML = "POINTS: " + points;
                    firstAttempt = true;
                }
            }

            function writeLetter() {
                if (firstAttempt  &&  (document.getElementById("letter").value).toUpperCase() == idFromLastSquareRemoved[0].toUpperCase() ) {
                    points += pointWriteCorrectLetter;
                    document.getElementById("points").innerHTML = "POINTS: " + points;
                    if (points == maxPoints){
                        document.getElementById("points").innerHTML = "POINTS: " + points + "\nMAX POINTS!!!";
                    }
                }
                document.getElementById("letter").value = "";
                firstAttempt = false;
            }

        </script>

    </body>
</html>